
    <!-- Top Navigation (Tier 1) -->
    <div class="top-nav">
        <a href="https://www.sailorskills.com/" class="nav-logo">SAILOR SKILLS</a>
        <a href="#" class="logout-link" id="ss-logout-link">Logout</a>
    </div>
    <!-- Global Navigation Header -->
    <header class="global-header">
        <div class="global-nav-container">
            <nav class="global-nav">
                <a href="https://sailorskills-dashboard.vercel.app">DASHBOARD</a>
                <a href="https://sailorskills-billing.vercel.app" class="active">BILLING</a>
                <a href="https://sailorskills-operations.vercel.app">OPERATIONS</a>
                <a href="https://sailorskills-inventory.vercel.app">INVENTORY</a>
                <a href="https://sailorskills-video.vercel.app">VIDEO</a>
                <a href="https://sailorskills-estimator.vercel.app">ESTIMATOR</a>
            </nav>
        </div>
    </header>
    <div id="nav-container"></div>
    <!-- Global Navigation (will be injected by shared/ui/navigation.js) -->

    <!-- Main Content -->
    <main class="main-content">
<div id="successModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; animation: slideDown 0.3s ease-out;">
        <div id="successModalContent"></div>
    </div>
</div>
<!-- Success Confirmation Modal -->

<div id="customerSelectionModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close" onclick="window.adminApp.closeCustomerModal()">√ó</span>
        <h2>Customer Information</h2>

        <div style="margin-bottom: 20px;">
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="modalCustomerName" style="display: block; margin-bottom: 5px;">Name *</label>
                <div style="position: relative;">
                    <input type="text" id="modalCustomerName" placeholder="Start typing to search existing customers..." style="width: 100%; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px;" oninput="window.searchModalCustomer(this.value)" autocomplete="off" required="">
                    <div id="modalCustomerSearchResults" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-radius: 5px; max-height: 200px; overflow-y: auto; display: none; z-index: 1001; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"></div>
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 15px;">
                <label for="modalCustomerEmail" style="display: block; margin-bottom: 5px;">Email *</label>
                <input type="email" id="modalCustomerEmail" placeholder="customer@example.com" style="width: 100%; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px;" required="">
            </div>

            <div class="form-group" style="margin-bottom: 15px;">
                <label for="modalCustomerPhone" style="display: block; margin-bottom: 5px;">Phone</label>
                <input type="tel" id="modalCustomerPhone" placeholder="(555) 123-4567" style="width: 100%; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px;">
            </div>

            <!-- Payment Method Info Display -->
            <div id="modalPaymentMethodInfo" style="display: none; margin-bottom: 15px; padding: 12px; background: #e8f5e9; border: 1px solid #4caf50; border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #2e7d32;">
                    <span style="font-size: 18px;">üí≥</span>
                    <span id="modalPaymentMethodDetails" style="font-weight: 500;"></span>
                    <span style="color: #4caf50; font-size: 16px;">‚úì</span>
                </div>
            </div>

            <h3 style="margin-top: 20px; margin-bottom: 10px;">Boat Information</h3>

            <div class="form-group" style="margin-bottom: 15px;">
                <label for="modalBoatName" style="display: block; margin-bottom: 5px;">Boat Name</label>
                <input type="text" id="modalBoatName" placeholder="Serenity" style="width: 100%; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="modalBoatLength" style="display: block; margin-bottom: 5px;">Boat Length (ft)</label>
                    <input type="number" id="modalBoatLength" placeholder="35" min="20" max="100" oninput="if(window.updateWizardPricing) window.updateWizardPricing();" style="width: 100%; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px;">
                </div>

                <div class="form-group">
                    <label for="modalBoatMake" style="display: block; margin-bottom: 5px;">Make</label>
                    <input type="text" id="modalBoatMake" placeholder="Catalina" style="width: 100%; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px;">
                </div>
            </div>

            <div class="form-group" style="margin-top: 15px;">
                <label for="modalBoatModel" style="display: block; margin-bottom: 5px;">Model</label>
                <input type="text" id="modalBoatModel" placeholder="Catalina 350" style="width: 100%; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px;">
            </div>
        </div>

        <!-- Payment Method Section -->
        <div id="modalPaymentSection" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
            <h3 style="margin-bottom: 15px;">üí≥ Payment Information</h3>
            <div id="modalPaymentInfo" style="margin-bottom: 15px; padding: 12px; background: #f0f7ff; border-radius: 8px; font-size: 14px; color: #0066cc;">
                <!-- Payment info/instructions will be shown here -->
            </div>
            <form id="modal-payment-form" autocomplete="off" data-private="true">
                <div id="modal-card-element" style="padding: 12px; border: 1px solid #ddd; border-radius: 6px; background: white; margin-bottom: 10px;">
                    <!-- Stripe card element will be mounted here -->
                </div>
                <div id="modal-card-errors" role="alert" style="color: #e74c3c; margin-bottom: 10px; min-height: 20px; font-size: 14px;"></div>
            </form>
        </div>

        <div class="form-actions" style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
            <button type="button" onclick="window.adminApp.closeCustomerModal()" class="cancel-btn">Cancel</button>
            <button type="button" onclick="window.adminApp.processCustomerAndPayment()" class="submit-btn" id="modalChargeButton">
                üí≥ Charge Customer <span id="modalChargeAmount"></span>
            </button>
        </div>
    </div>
</div>
<!-- Customer Selection Modal -->

<div id="serviceSelectionModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <span class="close" onclick="window.closeServiceSelectionModal()">√ó</span>
        <h2 style="margin-bottom: 20px;">Select Service to Bill</h2>

        <div id="customerServiceInfo" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <!-- Customer info will be shown here -->
        </div>

        <div id="existingServicesList" style="margin-bottom: 20px;">
            <!-- List of customer's existing services will be shown here -->
        </div>

        <div style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: 15px;">
            <button onclick="window.chooseManualService()" class="secondary-btn" style="width: 100%; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 15px;">
                Bill for Different Service
            </button>
        </div>
    </div>
</div>
<!-- Service Selection Modal -->

<div id="newCustomerModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="window.adminApp.closeCreateCustomerForm()">√ó</span>
        <h2>Create New Customer</h2>
        <form id="newCustomerForm">
            <div class="form-group">
                <label for="newCustomerName">Full Name *</label>
                <input type="text" id="newCustomerName" name="name" required="" placeholder="John Doe" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerEmail">Email *</label>
                <input type="email" id="newCustomerEmail" name="email" required="" placeholder="customer@example.com" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerPhone">Phone</label>
                <input type="tel" id="newCustomerPhone" name="phone" placeholder="+1 (555) 123-4567" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerBoatName">Boat Name</label>
                <input type="text" id="newCustomerBoatName" name="boat_name" placeholder="Serenity" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerBoatLength">Boat Length (feet)</label>
                <input type="number" id="newCustomerBoatLength" name="boat_length" min="20" max="100" placeholder="35" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerBoatMake">Boat Make/Manufacturer</label>
                <input type="text" id="newCustomerBoatMake" name="boat_make" placeholder="Catalina, Beneteau, etc." style="">
            </div>
            <div class="form-group">
                <label for="newCustomerBoatModel">Boat Model</label>
                <input type="text" id="newCustomerBoatModel" name="boat_model" placeholder="Oceanis 45, Hunter 36, etc." style="">
            </div>
            <div class="form-group">
                <label for="newCustomerBoatYear">Boat Year</label>
                <input type="number" id="newCustomerBoatYear" name="boat_year" min="1900" max="2025" placeholder="2018" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerMarina">Marina</label>
                <input type="text" id="newCustomerMarina" name="marina" placeholder="San Francisco Marina" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerDock">Dock</label>
                <input type="text" id="newCustomerDock" name="dock" placeholder="A, B, C, etc." style="">
            </div>
            <div class="form-group">
                <label for="newCustomerSlip">Slip Number</label>
                <input type="text" id="newCustomerSlip" name="slip" placeholder="123" style="">
            </div>
            <div class="form-group">
                <label for="newCustomerNotes">Notes</label>
                <textarea id="newCustomerNotes" name="description" rows="3" placeholder="Any additional notes about the customer or boat..." style=""></textarea>
            </div>
            <div class="form-actions">
                <button type="button" onclick="window.adminApp.closeCreateCustomerForm()" class="cancel-btn">Cancel</button>
                <button type="submit" class="submit-btn">Create Customer</button>
            </div>
        </form>
    </div>
</div>
<!-- New Customer Modal -->

<div id="paymentMethodModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closePaymentMethodForm()">√ó</span>
        <h2>Add Payment Method</h2>
        <div id="paymentCustomerInfo" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <!-- Customer info will be populated here -->
        </div>
        <form id="payment-form" autocomplete="off" data-private="true">
            <div id="card-element" style="padding: 12px; border: 1px solid #ddd; border-radius: 6px; background: white;">
                <!-- Stripe card element will be mounted here -->
            </div>
            <div id="card-errors" role="alert" style="color: #e74c3c; margin-top: 10px; min-height: 20px;"></div>
            <div class="form-actions" style="margin-top: 20px;">
                <button type="button" onclick="closePaymentMethodForm()" class="cancel-btn">Cancel</button>
                <button type="submit" id="submit-payment" class="submit-btn">Add Card</button>
            </div>
        </form>
    </div>
</div>
<!-- Add Payment Method Modal -->
        <!-- Modal templates extracted to src/templates/modals/ -->
        <!-- Modals are now loaded via modal-loader.js using Vite ?raw imports -->
        <!-- Phase 3c: Modal Template Extraction -->
        <!-- 5 modals extracted: payment-method, new-customer, service-selection, customer-selection, success -->

        <div class="container">
            <!-- Service Selection -->
            <div class="service-selector">
                <h2>Select Service Type</h2>
                <div id="simpleServiceButtons" class="simple-service-buttons">
                    <button onclick="window.selectServiceDirect('recurring_cleaning')" class="simple-service-btn" style="padding: 16px 20px; background: linear-gradient(135deg, #5B3A99 0%, #6B4A9E 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 6px rgba(91, 58, 153, 0.3); transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2); min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        üîÑ Recurring Cleaning
                    </button>
                    <button onclick="window.selectServiceDirect('onetime_cleaning')" class="simple-service-btn" style="padding: 16px 20px; background: linear-gradient(135deg, #1E5F8E 0%, #2471A3 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 6px rgba(30, 95, 142, 0.3); transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2); min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        ‚ú® One-Time Cleaning
                    </button>
                    <button onclick="window.selectServiceDirect('underwater_inspection')" class="simple-service-btn" style="padding: 16px 20px; background: linear-gradient(135deg, #0E7BA7 0%, #138FB5 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 6px rgba(14, 123, 167, 0.3); transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2); min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        üîç Underwater Inspection
                    </button>
                    <button onclick="window.selectServiceDirect('item_recovery')" class="simple-service-btn" style="padding: 16px 20px; background: linear-gradient(135deg, #C73E79 0%, #D84361 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 6px rgba(199, 62, 121, 0.3); transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2); min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        üîë Item Recovery
                    </button>
                    <button onclick="window.selectServiceDirect('propeller_service')" class="simple-service-btn" style="padding: 16px 20px; background: linear-gradient(135deg, #D68910 0%, #E59E1B 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 6px rgba(214, 137, 16, 0.3); transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2); min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        ‚öôÔ∏è Propeller Service
                    </button>
                    <button onclick="window.selectServiceDirect('anodes_only')" class="simple-service-btn" style="padding: 16px 20px; background: linear-gradient(135deg, #C0392B 0%, #E74C3C 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 6px rgba(192, 57, 43, 0.3); transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2); min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        üîã Anodes Only
                    </button>
                </div>

                <!-- Customer Search/Create Section (shown after service selected) -->
                <div id="customerSelectionSection" style="display: none; margin-top: 30px;">
                    <h2 style="margin-bottom: 20px;">üë§ Customer Information</h2>

                    <!-- Universal Search -->
                    <div style="margin-bottom: 20px;">
                        <div style="position: relative;">
                            <input type="text" id="universalSearch" placeholder="üîç Search existing customer by name, email, or boat name..." style="width: 100%; padding: 15px 20px; font-size: 16px; border: 2px solid rgb(221, 221, 221); border-radius: 8px; box-shadow: rgba(0, 0, 0, 0.05) 0px 2px 4px; transition: border-color 0.3s;">
                            <div id="universalSearchResults" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-radius: 8px; max-height: 400px; overflow-y: auto; display: none; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 5px;">
                            </div>
                        </div>
                    </div>

                    <!-- OR Divider -->
                    <div style="text-align: center; margin: 20px 0; color: #999; font-size: 14px; font-weight: 500;">
                        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ OR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                    </div>

                    <!-- Create New Customer Button -->
                    <div style="text-align: center; margin-bottom: 30px;">
                        <button id="createNewCustomerBtn" onclick="window.showNewCustomerForm()" style="padding: 12px 30px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3); transition: all 0.3s;">
                            + Create New Customer
                        </button>
                    </div>

                    <!-- Customer Info Cards (shown when existing customer selected) -->
                    <div id="customerInfoCards" style="display: none;"></div>

                    <!-- New Customer Form (shown when creating new) -->
                    <div id="newCustomerFormSection" style="display: none;"></div>
                </div>

                <div id="wizardContainer" style="display: none;">
                    <div id="wizardContent"></div>
                </div>
            </div>

            <!-- Start Service Time Tracking -->
            <div id="startServiceContainer" class="time-tracking-container start" style="display: none;">
                <div class="time-tracking-center">
                    <button id="startServiceBtn" class="time-tracking-btn start" onclick="window.startService()">
                        ‚è±Ô∏è Start Service
                    </button>
                    <div id="startTimeDisplay" class="time-display-container" style="display: none;">
                        <div class="time-display-flex">
                            <span id="startTimeText" class="time-display-text start"></span>
                            <button id="editStartTimeBtn" class="time-edit-btn start" onclick="window.editStartTime()">
                                ‚úèÔ∏è Edit
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conditions Tracking Section -->
            <div id="conditionsSection" class="conditions-section" style="display: none;">
                <h2>üìã Service Conditions &amp; Tracking</h2>

                <!-- Paint Condition Slider -->
                <div class="condition-group">
                    <label class="condition-label">Paint Condition</label>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 13px; color: #666;">
                        <div id="paintConditionHistorical" style="flex: 1;">Last service: <span id="paintLastValue">N/A</span></div>
                        <div style="flex: 1; text-align: right; font-weight: 600; color: #2c3e50;">This service: <span id="paintConditionValue">Not Inspected</span></div>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="actualPaintCondition" class="condition-slider paint-slider" min="0" max="8" value="0" step="1" oninput="this.setAttribute('data-user-set', 'true'); updateSliderDisplay('actualPaintCondition', 'paintConditionValue'); if(window.updateWizardPricing) window.updateWizardPricing();" style="">
                        <div class="slider-labels">
                            <span>Not Inspected</span>
                            <span>Excellent</span>
                            <span>Exc-Good</span>
                            <span>Good</span>
                            <span>Good-Fair</span>
                            <span>Fair</span>
                            <span>Fair-Poor</span>
                            <span>Poor</span>
                            <span>Very Poor</span>
                        </div>
                    </div>
                </div>

                <!-- Growth Level Slider -->
                <div class="condition-group">
                    <label class="condition-label">Growth Level</label>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 13px; color: #666;">
                        <div id="growthLevelHistorical" style="flex: 1;">Last service: <span id="growthLastValue">N/A</span></div>
                        <div style="flex: 1; text-align: right; font-weight: 600; color: #2c3e50;">This service: <span id="growthLevelValue">Not Inspected</span></div>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="actualGrowthLevel" class="condition-slider growth-slider" min="0" max="8" value="0" step="1" oninput="this.setAttribute('data-user-set', 'true'); updateSliderDisplay('actualGrowthLevel', 'growthLevelValue'); if(window.updateWizardPricing) window.updateWizardPricing();" style="">
                        <div class="slider-labels">
                            <span>Not Inspected</span>
                            <span>Minimal</span>
                            <span>Min-Mod</span>
                            <span>Moderate</span>
                            <span>Mod-Heavy</span>
                            <span>Heavy</span>
                            <span>Heavy-Severe</span>
                            <span>Severe</span>
                            <span>Extreme</span>
                        </div>
                    </div>
                </div>

                <!-- Anode Location Management -->
                <div class="condition-group">
                    <label class="condition-label">‚öì Anode Locations &amp; Conditions</label>
                    <div class="anode-locations-manager">
                        <!-- Edit Anode Locations Button -->
                        <button id="editAnodeButton" class="btn btn-secondary" onclick="toggleAnodeEditMode()" style="margin-bottom: 10px; width: 100%;">
                            ‚úèÔ∏è Edit Anode Locations
                        </button>

                        <!-- Anode selector hidden by default, shown in edit mode -->
                        <div id="anodeLocationSelector" style="display: none; margin-bottom: 15px;">
                            <div class="anode-quick-select" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                <button class="anode-location-btn" onclick="selectAnodeLocation('thruster')" data-location="thruster">
                                    <span class="location-name">Bow Thruster</span>
                                    <span class="location-count" id="count-thruster">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('keel')" data-location="keel">
                                    <span class="location-name">Keel</span>
                                    <span class="location-count" id="count-keel">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('hull')" data-location="hull">
                                    <span class="location-name">Hull</span>
                                    <span class="location-count" id="count-hull">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('shaft')" data-location="shaft">
                                    <span class="location-name">Shaft</span>
                                    <span class="location-count" id="count-shaft">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('strut')" data-location="strut">
                                    <span class="location-name">Strut</span>
                                    <span class="location-count" id="count-strut">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('prop')" data-location="prop">
                                    <span class="location-name">Prop</span>
                                    <span class="location-count" id="count-prop">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('rudder')" data-location="rudder">
                                    <span class="location-name">Rudder</span>
                                    <span class="location-count" id="count-rudder">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('trimtab')" data-location="trimtab">
                                    <span class="location-name">Trim Tab</span>
                                    <span class="location-count" id="count-trimtab">0</span>
                                </button>
                                <button class="anode-location-btn" onclick="selectAnodeLocation('saildrive')" data-location="saildrive">
                                    <span class="location-name">Stern Thruster</span>
                                    <span class="location-count" id="count-saildrive">0</span>
                                </button>
                            </div>
                        </div>

                        <!-- Anode Assignments List -->
                        <div id="anodeAssignmentsList" class="anode-assignments-list"></div>
                    </div>
                </div>

                <!-- Propeller Conditions -->
                <div class="condition-group">
                    <label class="condition-label">Propeller 1 Condition</label>
                    <div id="prop1Historical" class="historical-context"></div>
                    <div class="button-group">
                        <button class="condition-btn" data-value="excellent" onclick="setCondition('wizardPropeller1', 'excellent', this)">Excellent</button>
                        <button class="condition-btn" data-value="good" onclick="setCondition('wizardPropeller1', 'good', this)">Good</button>
                        <button class="condition-btn" data-value="minor_damage" onclick="setCondition('wizardPropeller1', 'minor_damage', this)">Minor Damage</button>
                        <button class="condition-btn" data-value="damaged" onclick="setCondition('wizardPropeller1', 'damaged', this)">Damaged</button>
                        <button class="condition-btn" data-value="electrolysis" onclick="setCondition('wizardPropeller1', 'electrolysis', this)">Electrolysis</button>
                    </div>
                    <input type="hidden" id="wizardPropeller1" value="" style="">
                </div>

                <div class="condition-group" id="propeller2ConditionGroup" style="display: none;">
                    <label class="condition-label">Propeller 2 Condition</label>
                    <div id="prop2Historical" class="historical-context"></div>
                    <div class="button-group">
                        <button class="condition-btn" data-value="excellent" onclick="setCondition('wizardPropeller2', 'excellent', this)">Excellent</button>
                        <button class="condition-btn" data-value="good" onclick="setCondition('wizardPropeller2', 'good', this)">Good</button>
                        <button class="condition-btn" data-value="minor_damage" onclick="setCondition('wizardPropeller2', 'minor_damage', this)">Minor Damage</button>
                        <button class="condition-btn" data-value="damaged" onclick="setCondition('wizardPropeller2', 'damaged', this)">Damaged</button>
                        <button class="condition-btn" data-value="electrolysis" onclick="setCondition('wizardPropeller2', 'electrolysis', this)">Electrolysis</button>
                    </div>
                    <input type="hidden" id="wizardPropeller2" value="" style="">
                    <textarea id="wizardPropellerNotes" placeholder="Additional notes about propellers..." rows="2" class="condition-notes" style=""></textarea>
                </div>

                <!-- Through-Hull Condition -->
                <div class="condition-group">
                    <label class="condition-label">Through-Hull Condition</label>
                    <div id="thruHullHistorical" class="historical-context"></div>
                    <div class="button-group">
                        <button class="condition-btn" data-value="sound" onclick="setCondition('wizardThruHull', 'sound', this)">Sound</button>
                        <button class="condition-btn" data-value="needs_attention" onclick="setCondition('wizardThruHull', 'needs_attention', this)">Needs Attention</button>
                    </div>
                    <input type="hidden" id="wizardThruHull" value="" style="">
                </div>

                <!-- General Notes -->
                <div class="condition-group">
                    <label class="condition-label">Service Notes</label>
                    <textarea id="wizardGeneralNotes" placeholder="General notes about this service (e.g., specific work performed, issues found, recommendations)..." rows="4" class="condition-notes" style=""></textarea>
                </div>
            </div>

            <div id="boatConfigSection" class="boat-config-section" style="display: none !important; /* PERMANENTLY HIDDEN - handled by wizard */">
                <!-- Legacy boat configuration - now handled by wizard -->
            </div>

            <div class="boat-details" style="display: none !important; /* PERMANENTLY HIDDEN - handled by wizard */">
                <!-- Legacy boat details - now handled by wizard -->
            </div>

            <!-- Dynamic Pricing Display -->
            <div id="pricingDisplay" class="pricing-display" style="display: none;">
                <h3>üí∞ Price Breakdown</h3>
                <div id="priceBreakdown" class="price-breakdown"></div>
                <div class="charge-button-container" style="margin-top: 20px;">
                    <input type="number" id="editableAmount" class="amount-input" step="0.01" min="0" style="width: 150px; padding: 10px; font-size: 18px; margin-right: 10px;" onchange="updateChargeButton()">
                    <button id="pricingChargeButton" class="charge-button" onclick="chargeCustomer()" disabled="">
                        üí≥ Charge Customer
                    </button>
                </div>
            </div>

            <!-- End Service Time Tracking -->
            <div id="endServiceContainer" class="time-tracking-container end" style="display: none;">
                <div class="time-tracking-center">
                    <button id="endServiceBtn" class="time-tracking-btn end" onclick="window.endService()" disabled="">
                        ‚èπÔ∏è End Service
                    </button>
                    <div id="endTimeDisplay" class="time-display-container" style="display: none;">
                        <div class="time-display-flex">
                            <span id="endTimeText" class="time-display-text end"></span>
                            <button id="editEndTimeBtn" class="time-edit-btn end" onclick="window.editEndTime()">
                                ‚úèÔ∏è Edit
                            </button>
                        </div>
                        <div id="serviceDuration" class="service-duration"></div>
                    </div>
                </div>
            </div>

            <!-- Charge Summary -->
            <div class="charge-summary" style="display: none;">
                <h3>üìä Report</h3>
                <div class="charge-details" id="chargeDetails">
                    <div id="chargeSummaryContent">
                        <p>Select a customer and service to see pricing</p>
                    </div>
                </div>
                <!-- Payment Method Selector -->
                <div class="payment-method-selector">
                    <label for="paymentMethodSelect">Payment Method:</label>
                    <select id="paymentMethodSelect" onchange="window.updatePaymentMethodUI()">
                        <option value="stripe">üí≥ Credit Card (Stripe)</option>
                        <option value="zoho">üè¶ External Payment (Zoho/Other)</option>
                        <option value="cash">üíµ Cash</option>
                        <option value="check">üìù Check</option>
                        <option value="pending">‚è≥ Payment Pending</option>
                    </select>
                    <input type="text" id="paymentNotes" placeholder="Optional: Add payment reference (e.g., Zoho invoice #, check #)" style="display: none;">
                </div>
                <div class="charge-button-container">
                    <button id="chargeButton" class="charge-button" onclick="window.smartChargeOrInvoice()" title="Charge or invoice based on payment method availability">
                        üí≥ Charge Customer
                    </button>
                    <button id="logOnlyButton" class="charge-button" style="background: #2c5aa0;" onclick="window.logConditionsOnly()">
                        üìã Log Only (No Charge)
                    </button>
                    <button class="charge-button quote-button" onclick="window.adminApp.generateQuote()">
                        üìÑ Generate Quote
                    </button>
                </div>
            </div>

            <!-- Result Display -->
            <div id="chargeResult" class="charge-result"></div>

            <!-- Inline styles extracted to src/styles/billing-inline.css -->
            <!-- CSS is now bundled via Vite into billing.bundle.css -->

            <!-- Anode Management Section -->
            <div id="hiddenAnodeSection" class="anode-section">
                <div class="daily-schedule">
                    <h3>üìÖ Daily Schedule</h3>
                    <div class="schedule-date-selector">
                        <input type="date" id="serviceDate" value="" style="">
                        <button onclick="loadDailySchedule()" class="customer-btn">Load Schedule</button>
                    </div>
                    <div id="boatScheduleList" class="boat-schedule-list"></div>
                </div>

                <div class="anode-selector">
                    <h3>üîã Select Anodes</h3>
                    <div id="anodeCategories" class="anode-categories"></div>
                    <div id="anodeGrid" class="anode-grid"></div>

                    <div class="anode-cart">
                        <h4>Shopping Cart</h4>
                        <div id="cartItems"></div>
                        <div class="cart-total">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="cartSubtotal">$0.00</span>
                            </div>
                            <div class="total-row">
                                <span>Labor:</span>
                                <span id="cartLabor">$0.00</span>
                            </div>
                            <div class="total-row">
                                <span>Tax:</span>
                                <span id="cartTax">$0.00</span>
                            </div>
                            <div class="total-row grand-total">
                                <span>Total:</span>
                                <span id="cartTotal">$0.00</span>
                            </div>
                        </div>

                        <div style="margin-top: 20px;">
                            <h5>Pricing Settings</h5>
                            <div class="input-group">
                                <label>Tax Rate (%)</label>
                                <input type="number" id="taxRate" value="10.75" step="0.01" onchange="updateAnodeCart()" style="">
                            </div>
                            <div class="input-group">
                                <label>Markup (%)</label>
                                <input type="number" id="markupRate" value="20" step="1" onchange="updateAnodeCart()" style="">
                            </div>
                            <div class="input-group">
                                <label>Labor per Anode ($)</label>
                                <input type="number" id="laborCharge" value="15" step="1" onchange="updateAnodeCart()" style="">
                            </div>
                        </div>

                        <button class="charge-anode-btn" onclick="chargeAnodes()" disabled="">
                            üí≥ Charge Customer
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Hidden inputs for tracking state -->
    <input type="hidden" id="serviceKey" value="" style="">
    <input type="hidden" id="servicePrice" value="0" style="">
    <input type="hidden" id="anodesToInstall" value="0" style="">

    <!-- External Scripts -->
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Initialize Supabase and Environment Variables -->
    <!-- Supabase initialization moved to src/admin/inline-scripts/supabase-init.js -->
    <!-- Now bundled via Vite into billing.bundle.js -->

    <!-- Define selectServiceDirect immediately for button handlers -->
    <!-- Service selection functions moved to src/admin/inline-scripts/service-selection.js -->
    <!-- Now bundled via Vite into billing.bundle.js -->

    <!-- Load modules -->

    <!-- Hidden inputs for form data -->
    <input type="hidden" id="selectedCustomerId" value="" style="">
    <input type="hidden" id="boatName" value="" style="">
    <input type="hidden" id="boatLength" value="35" style="">
    <input type="hidden" id="paintCondition" value="good" style="">
    <input type="hidden" id="paint_condition" value="good" style="">
    <input type="hidden" id="growthLevel" value="minimal" style="">
    <input type="hidden" id="growth_level" value="minimal" style="">
    <!-- actualGrowthLevel and actualPaintCondition moved to conditions section sliders -->
    <input type="hidden" id="totalCost" value="0" style="">
    <input type="hidden" id="totalCostDisplay" value="0" style="">
    <input type="hidden" id="has_twin_engines" value="" style="">

    <!-- Hidden radio groups for boat/hull configuration -->
    <div style="display:none;">
        <input type="radio" name="boat_type" value="sailboat" checked="" style="">
        <input type="radio" name="boat_type" value="powerboat" style="">
        <input type="radio" name="hull_type" value="monohull" checked="" style="">
        <input type="radio" name="hull_type" value="catamaran" style="">
        <input type="radio" name="hull_type" value="trimaran" style="">
    </div>

    <!-- Shared Navigation Initialization -->

    <!-- Supabase Authentication -->

    <!-- Universal Search Functionality -->
    <!-- Universal search functionality moved to src/admin/inline-scripts/universal-search.js -->
    <!-- Now bundled via Vite into billing.bundle.js -->

    <!-- Service Conditions Logging -->
    <!-- Service conditions logging moved to src/admin/inline-scripts/conditions-logging.js -->
    <!-- Now bundled via Vite into billing.bundle.js -->

    <!-- Core Admin Functionality -->

    <!-- Wizard Payment Enhancement -->
    <!-- Wizard payment functionality moved to src/admin/inline-scripts/wizard-payment.js -->
    <!-- Now bundled via Vite into billing.bundle.js -->

    <!-- Enhanced Charge Flow - Use Saved Payment Methods -->
    <!-- Enhanced charge flow moved to src/admin/inline-scripts/enhanced-charge-flow.js -->
    <!-- Now bundled via Vite into billing.bundle.js -->

  <!-- Shared Navigation Initialization -->
  <script type="module">
    import { initNavigation } from 'https://sailorskills-shared.vercel.app/src/ui/navigation.js';
    initNavigation({
      currentPage: 'billing',
      breadcrumbs: [
        { label: 'Home', url: 'https://www.sailorskills.com/' },
        { label: 'Admin', url: 'https://sailorskills-dashboard.vercel.app' },
        { label: 'Billing' }
      ]
    });
  </script>


<iframe name="__privateStripeMetricsController2280" frameborder="0" allowtransparency="true" scrolling="no" role="presentation" allow="payment *" src="https://js.stripe.com/v3/m-outer-3437aaddcdf6922d623e172c2d6f9278.html#url=https%3A%2F%2Fsailorskills-billing.vercel.app%2F&amp;title=Billing%20-%20Charge%20Customer%20%7C%20Sailor%20Skills&amp;referrer=&amp;muid=NA&amp;sid=NA&amp;version=6&amp;preview=false&amp;__shared_params__[version]=v3" aria-hidden="true" tabindex="-1" style="border: none !important; margin: 0px !important; padding: 0px !important; width: 1px !important; min-width: 100% !important; overflow: hidden !important; display: block !important; visibility: hidden !important; position: fixed !important; height: 1px !important; pointer-events: none !important; user-select: none !important;"></iframe>